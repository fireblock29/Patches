<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation - A09:2021 Security Logging and Monitoring Failures</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <h1>üîì Vulnerable Logging App</h1>
            <ul>
                <li><a href="/">Accueil</a></li>
                <li><a href="/login">Connexion</a></li>
                <li><a href="/logs" class="danger">üìã Voir les Logs</a></li>
                <li><a href="/documentation" class="active">üìö Documentation</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="doc-header">
            <h1>üìö A09:2021 ‚Äì Security Logging and Monitoring Failures</h1>
            <p class="subtitle">Guide P√©dagogique Complet</p>
        </div>

        <div class="toc">
            <h3>üìë Table des Mati√®res</h3>
            <ul>
                <li><a href="#introduction">Introduction</a></li>
                <li><a href="#vulnerabilities">Vuln√©rabilit√©s D√©montr√©es</a></li>
                <li><a href="#exploitation">Sc√©narios d'Exploitation</a></li>
                <li><a href="#impact">Impact et Risques</a></li>
                <li><a href="#prevention">Mesures de Pr√©vention</a></li>
                <li><a href="#best-practices">Bonnes Pratiques</a></li>
                <li><a href="#examples">Exemples de Code</a></li>
                <li><a href="#resources">Ressources Suppl√©mentaires</a></li>
            </ul>
        </div>

        <section id="introduction" class="doc-section">
            <h2>üéØ Introduction</h2>
            <div class="card">
                <p><strong>A09:2021 ‚Äì Security Logging and Monitoring Failures</strong> fait partie du Top 10 OWASP 2021.</p>
                <p>Cette vuln√©rabilit√© survient lorsque:</p>
                <ul>
                    <li>Les √©v√©nements de s√©curit√© ne sont pas logg√©s correctement</li>
                    <li>Les logs contiennent des donn√©es sensibles</li>
                    <li>Les logs sont accessibles sans authentification</li>
                    <li>Il n'y a pas de monitoring actif des √©v√©nements de s√©curit√©</li>
                    <li>Les alertes ne sont pas d√©clench√©es lors d'activit√©s suspectes</li>
                </ul>
            </div>
        </section>

        <section id="vulnerabilities" class="doc-section">
            <h2>üîì Vuln√©rabilit√©s D√©montr√©es dans cette Application</h2>
            
            <div class="vulnerability-card critical">
                <h3>1. üî• Exposition Publique des Logs</h3>
                <p><strong>Criticit√©: CRITIQUE</strong></p>
                <p><strong>Description:</strong> Les fichiers de logs sont accessibles via une URL publique sans aucune authentification.</p>
                <p><strong>Localisation:</strong> <code>/logs</code>, <code>/api/logs</code>, <code>/api/download-logs</code></p>
                <p><strong>Impact:</strong> N'importe qui peut lire tous les logs de l'application.</p>
                <div class="code-example">
                    <pre>
# Exploitation:
curl http://localhost:5000/api/logs?type=sensitive&lines=1000
curl http://localhost:5000/api/download-logs?type=sensitive -o logs.txt
                    </pre>
                </div>
            </div>

            <div class="vulnerability-card critical">
                <h3>2. üîë Mots de Passe en Clair dans les Logs</h3>
                <p><strong>Criticit√©: CRITIQUE</strong></p>
                <p><strong>Description:</strong> Les mots de passe sont logg√©s en clair lors des tentatives de connexion.</p>
                <p><strong>Code vuln√©rable:</strong></p>
                <div class="code-example">
                    <pre>
# Dans app.py (ligne ~75)
app.logger.warning(f"Login attempt - Username: {username}, Password: {password}")
sensitive_logger.critical(f"CREDENTIALS - User: {username}, Pass: {password}")
                    </pre>
                </div>
                <p><strong>Impact:</strong> Tous les mots de passe peuvent √™tre r√©cup√©r√©s par un attaquant.</p>
            </div>

            <div class="vulnerability-card high">
                <h3>3. üí≥ Donn√©es Financi√®res Logg√©es</h3>
                <p><strong>Criticit√©: HAUTE</strong></p>
                <p><strong>Description:</strong> Les transactions financi√®res compl√®tes sont logg√©es avec tous les d√©tails.</p>
                <p><strong>Code vuln√©rable:</strong></p>
                <div class="code-example">
                    <pre>
# Dans app.py (ligne ~110)
sensitive_logger.critical(
    f"FINANCIAL TRANSACTION - From: {from_account}, To: {to_account}, "
    f"Amount: ${amount}, IP: {request.remote_addr}"
)
                    </pre>
                </div>
                <p><strong>Impact:</strong> Exposition de toutes les transactions financi√®res.</p>
            </div>

            <div class="vulnerability-card high">
                <h3>4. üë§ Donn√©es Personnelles (PII) Logg√©es</h3>
                <p><strong>Criticit√©: HAUTE</strong></p>
                <p><strong>Description:</strong> Les donn√©es personnelles identifiables sont logg√©es sans masquage.</p>
                <p><strong>Donn√©es expos√©es:</strong></p>
                <ul>
                    <li>Emails</li>
                    <li>Num√©ros de t√©l√©phone</li>
                    <li>Num√©ros de s√©curit√© sociale</li>
                    <li>Adresses postales</li>
                </ul>
            </div>

            <div class="vulnerability-card medium">
                <h3>5. üîç Recherche dans les Logs Sans Authentification</h3>
                <p><strong>Criticit√©: MOYENNE</strong></p>
                <p><strong>Description:</strong> Une API de recherche permet de fouiller dans les logs.</p>
                <p><strong>Localisation:</strong> <code>/api/search-logs</code></p>
                <div class="code-example">
                    <pre>
# Exploitation:
curl "http://localhost:5000/api/search-logs?q=password&type=sensitive"
                    </pre>
                </div>
            </div>

            <div class="vulnerability-card medium">
                <h3>6. üó∫Ô∏è R√©v√©lation de la Structure Interne</h3>
                <p><strong>Criticit√©: MOYENNE</strong></p>
                <p><strong>Description:</strong> Les logs r√©v√®lent la structure interne de l'application, les routes, les param√®tres, etc.</p>
                <p><strong>Impact:</strong> Facilite la d√©couverte d'autres vuln√©rabilit√©s.</p>
            </div>
        </section>

        <section id="exploitation" class="doc-section">
            <h2>‚öîÔ∏è Sc√©narios d'Exploitation</h2>
            
            <div class="card">
                <h3>Sc√©nario 1: Vol de Credentials</h3>
                <ol>
                    <li>L'attaquant d√©couvre l'URL <code>/logs</code></li>
                    <li>Il acc√®de aux logs sans authentification</li>
                    <li>Il recherche "password" ou "CREDENTIALS"</li>
                    <li>Il r√©cup√®re tous les mots de passe en clair</li>
                    <li>Il peut maintenant se connecter avec n'importe quel compte</li>
                </ol>
                <div class="code-example">
                    <pre>
# Commandes d'exploitation:
curl http://localhost:5000/api/search-logs?q=CREDENTIALS&type=sensitive
# R√©sultat: Tous les mots de passe en clair!
                    </pre>
                </div>
            </div>

            <div class="card">
                <h3>Sc√©nario 2: Espionnage Financier</h3>
                <ol>
                    <li>L'attaquant acc√®de aux logs sensibles</li>
                    <li>Il recherche "FINANCIAL TRANSACTION"</li>
                    <li>Il obtient la liste compl√®te de toutes les transactions</li>
                    <li>Il peut identifier les comptes riches</li>
                    <li>Il peut cibler des attaques sp√©cifiques</li>
                </ol>
            </div>

            <div class="card">
                <h3>Sc√©nario 3: Vol de Donn√©es Personnelles</h3>
                <ol>
                    <li>L'attaquant t√©l√©charge tous les logs</li>
                    <li>Il extrait toutes les donn√©es personnelles (PII)</li>
                    <li>Il peut utiliser ces donn√©es pour du phishing</li>
                    <li>Il peut vendre ces donn√©es sur le dark web</li>
                    <li>Violation du RGPD et autres r√©glementations</li>
                </ol>
            </div>
        </section>

        <section id="impact" class="doc-section">
            <h2>üí• Impact et Risques</h2>
            
            <div class="grid">
                <div class="impact-card critical">
                    <h3>üî¥ Impact Critique</h3>
                    <ul>
                        <li>Compromission totale des comptes utilisateurs</li>
                        <li>Vol de donn√©es financi√®res</li>
                        <li>Violation massive de donn√©es personnelles</li>
                        <li>Non-conformit√© RGPD (amendes jusqu'√† 4% du CA)</li>
                    </ul>
                </div>

                <div class="impact-card high">
                    <h3>üü† Impact √âlev√©</h3>
                    <ul>
                        <li>Perte de confiance des clients</li>
                        <li>Dommages r√©putationnels</li>
                        <li>Poursuites judiciaires</li>
                        <li>Co√ªts de rem√©diation √©lev√©s</li>
                    </ul>
                </div>

                <div class="impact-card medium">
                    <h3>üü° Impact Moyen</h3>
                    <ul>
                        <li>Facilite d'autres attaques</li>
                        <li>R√©v√©lation de la structure interne</li>
                        <li>Identification des utilisateurs actifs</li>
                        <li>Cartographie du syst√®me</li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="prevention" class="doc-section">
            <h2>üõ°Ô∏è Mesures de Pr√©vention</h2>
            
            <div class="card">
                <h3>1. ‚úÖ Ne JAMAIS Logger de Donn√©es Sensibles</h3>
                <div class="comparison">
                    <div class="bad">
                        <h4>‚ùå Mauvais:</h4>
                        <pre>
logger.info(f"Login: {username}, Password: {password}")
logger.info(f"Credit card: {card_number}")
                        </pre>
                    </div>
                    <div class="good">
                        <h4>‚úÖ Bon:</h4>
                        <pre>
logger.info(f"Login attempt for user: {username}")
logger.info(f"Payment processed for card ending in: {card_number[-4:]}")
                        </pre>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>2. üîê Prot√©ger l'Acc√®s aux Logs</h3>
                <ul>
                    <li>Authentification forte requise (MFA recommand√©)</li>
                    <li>Contr√¥le d'acc√®s bas√© sur les r√¥les (RBAC)</li>
                    <li>Logs stock√©s hors du webroot</li>
                    <li>Permissions syst√®me restrictives (chmod 600)</li>
                    <li>Logs accessibles uniquement via SSH/VPN</li>
                </ul>
            </div>

            <div class="card">
                <h3>3. üé≠ Masquer les Donn√©es Sensibles</h3>
                <div class="code-example">
                    <pre>
def mask_sensitive_data(data, visible_chars=4):
    """Masque les donn√©es sensibles"""
    if len(data) <= visible_chars:
        return '*' * len(data)
    return '*' * (len(data) - visible_chars) + data[-visible_chars:]

# Utilisation:
logger.info(f"Card: {mask_sensitive_data(card_number)}")
# R√©sultat: Card: ************1234
                    </pre>
                </div>
            </div>

            <div class="card">
                <h3>4. üîÑ Rotation et Archivage des Logs</h3>
                <ul>
                    <li>Rotation automatique des logs (taille/date)</li>
                    <li>Archivage s√©curis√© des anciens logs</li>
                    <li>Chiffrement des logs archiv√©s</li>
                    <li>Politique de r√©tention claire</li>
                    <li>Suppression s√©curis√©e apr√®s la p√©riode de r√©tention</li>
                </ul>
            </div>

            <div class="card">
                <h3>5. üìä Monitoring et Alertes</h3>
                <ul>
                    <li>Monitoring en temps r√©el des √©v√©nements de s√©curit√©</li>
                    <li>Alertes automatiques sur activit√©s suspectes</li>
                    <li>D√©tection d'anomalies (tentatives de connexion multiples, etc.)</li>
                    <li>Int√©gration avec un SIEM (Security Information and Event Management)</li>
                    <li>Tableaux de bord de s√©curit√©</li>
                </ul>
            </div>
        </section>

        <section id="best-practices" class="doc-section">
            <h2>‚ú® Bonnes Pratiques</h2>
            
            <div class="best-practices-grid">
                <div class="practice-card">
                    <h3>üìù Que Logger?</h3>
                    <ul>
                        <li>‚úÖ Tentatives de connexion (succ√®s/√©chec)</li>
                        <li>‚úÖ Changements de permissions</li>
                        <li>‚úÖ Acc√®s aux ressources sensibles</li>
                        <li>‚úÖ Erreurs et exceptions</li>
                        <li>‚úÖ Modifications de configuration</li>
                        <li>‚ùå Mots de passe</li>
                        <li>‚ùå Tokens d'authentification</li>
                        <li>‚ùå Donn√©es personnelles compl√®tes</li>
                        <li>‚ùå Donn√©es financi√®res compl√®tes</li>
                    </ul>
                </div>

                <div class="practice-card">
                    <h3>üéØ Niveaux de Log</h3>
                    <ul>
                        <li><strong>DEBUG:</strong> D√©veloppement uniquement</li>
                        <li><strong>INFO:</strong> √âv√©nements normaux</li>
                        <li><strong>WARNING:</strong> Situations anormales</li>
                        <li><strong>ERROR:</strong> Erreurs n√©cessitant attention</li>
                        <li><strong>CRITICAL:</strong> Probl√®mes graves</li>
                    </ul>
                    <p><strong>Production:</strong> WARNING et plus uniquement</p>
                </div>

                <div class="practice-card">
                    <h3>üîí S√©curit√© des Logs</h3>
                    <ul>
                        <li>Chiffrement en transit (TLS)</li>
                        <li>Chiffrement au repos</li>
                        <li>Int√©grit√© des logs (signatures)</li>
                        <li>Logs centralis√©s (serveur d√©di√©)</li>
                        <li>Sauvegarde r√©guli√®re</li>
                    </ul>
                </div>

                <div class="practice-card">
                    <h3>‚öñÔ∏è Conformit√©</h3>
                    <ul>
                        <li><strong>RGPD:</strong> Minimisation des donn√©es</li>
                        <li><strong>PCI-DSS:</strong> Protection des donn√©es de paiement</li>
                        <li><strong>HIPAA:</strong> Protection des donn√©es de sant√©</li>
                        <li>Politique de r√©tention conforme</li>
                        <li>Droit √† l'oubli</li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="examples" class="doc-section">
            <h2>üíª Exemples de Code S√©curis√©</h2>
            
            <div class="card">
                <h3>Configuration S√©curis√©e (Python/Flask)</h3>
                <div class="code-example">
                    <pre>
import logging
from logging.handlers import RotatingFileHandler
import os

# Configuration s√©curis√©e
LOG_DIR = '/var/log/myapp'  # Hors du webroot
LOG_FILE = os.path.join(LOG_DIR, 'app.log')

# Cr√©er le r√©pertoire avec permissions restrictives
os.makedirs(LOG_DIR, mode=0o700, exist_ok=True)

# Configuration du logger
handler = RotatingFileHandler(
    LOG_FILE,
    maxBytes=10485760,  # 10MB
    backupCount=10
)
handler.setFormatter(logging.Formatter(
    '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
))

logger = logging.getLogger(__name__)
logger.addHandler(handler)
logger.setLevel(logging.WARNING)  # WARNING+ en production

# Fonction de masquage
def mask_data(data, visible=4):
    if not data or len(data) <= visible:
        return '*' * len(data) if data else ''
    return '*' * (len(data) - visible) + data[-visible:]

# Utilisation s√©curis√©e
@app.route('/login', methods=['POST'])
def login():
    username = request.form.get('username')
    password = request.form.get('password')
    
    # ‚úÖ Bon: Ne pas logger le mot de passe
    logger.info(f"Login attempt for user: {username}")
    
    if authenticate(username, password):
        logger.info(f"Successful login: {username}")
        return jsonify({'success': True})
    else:
        logger.warning(f"Failed login attempt: {username}")
        return jsonify({'success': False}), 401
                    </pre>
                </div>
            </div>

            <div class="card">
                <h3>Protection des Endpoints de Logs</h3>
                <div class="code-example">
                    <pre>
from functools import wraps
from flask import abort

def admin_required(f):
    @wraps(f)
    def decorated_function(*args, **kwargs):
        # V√©rifier l'authentification et les permissions
        if not is_authenticated() or not is_admin():
            logger.warning(f"Unauthorized log access attempt from {request.remote_addr}")
            abort(403)
        return f(*args, **kwargs)
    return decorated_function

@app.route('/admin/logs')
@admin_required
def view_logs():
    # Seulement accessible aux admins authentifi√©s
    return render_template('logs.html')
                    </pre>
                </div>
            </div>
        </section>

        <section id="resources" class="doc-section">
            <h2>üìö Ressources Suppl√©mentaires</h2>
            
            <div class="resources-grid">
                <div class="resource-card">
                    <h3>üîó OWASP</h3>
                    <ul>
                        <li><a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/" target="_blank">A09:2021 ‚Äì Security Logging and Monitoring Failures</a></li>
                        <li><a href="https://cheatsheetseries.owasp.org/cheatsheets/Logging_Cheat_Sheet.html" target="_blank">OWASP Logging Cheat Sheet</a></li>
                    </ul>
                </div>

                <div class="resource-card">
                    <h3>üìñ Documentation</h3>
                    <ul>
                        <li><a href="https://www.python.org/dev/peps/pep-0282/" target="_blank">Python Logging</a></li>
                        <li><a href="https://docs.python.org/3/library/logging.html" target="_blank">Python Logging Module</a></li>
                    </ul>
                </div>

                <div class="resource-card">
                    <h3>üõ†Ô∏è Outils</h3>
                    <ul>
                        <li>ELK Stack (Elasticsearch, Logstash, Kibana)</li>
                        <li>Splunk</li>
                        <li>Graylog</li>
                        <li>Datadog</li>
                    </ul>
                </div>

                <div class="resource-card">
                    <h3>‚öñÔ∏è R√©glementations</h3>
                    <ul>
                        <li><a href="https://gdpr.eu/" target="_blank">RGPD</a></li>
                        <li><a href="https://www.pcisecuritystandards.org/" target="_blank">PCI-DSS</a></li>
                        <li><a href="https://www.hhs.gov/hipaa/" target="_blank">HIPAA</a></li>
                    </ul>
                </div>
            </div>
        </section>

        <div class="cta-section">
            <h3>üß™ Testez les Vuln√©rabilit√©s</h3>
            <p>Maintenant que vous comprenez les risques, explorez l'application pour voir ces vuln√©rabilit√©s en action:</p>
            <div class="button-group">
                <a href="/login" class="btn btn-primary">Tester la Connexion</a>
                <a href="/logs" class="btn btn-danger">Voir les Logs Vuln√©rables</a>
            </div>
        </div>
    </div>

    <footer>
        <p>‚ö†Ô∏è Application p√©dagogique - A09:2021 Security Logging and Monitoring Failures ‚ö†Ô∏è</p>
    </footer>
</body>
</html>
